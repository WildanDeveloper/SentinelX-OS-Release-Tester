#!/bin/bash
#
# SentinelX Desktop Environment Manager
# Manages desktop environments and Wayland compositor
#
# Copyright (C) 2026 WildanDev
# License: GPL v3

set -e

VERSION="1.0.0"

# Colors
GREEN='\033[0;32m'
CYAN='\033[0;36m'
YELLOW='\033[1;33m'
NC='\033[0m'

show_banner() {
    cat << 'EOF'
╔════════════════════════════════════════════════════════════╗
║        SENTINELX DESKTOP ENVIRONMENT MANAGER               ║
║              Wayland-Native Desktop Setup                  ║
╚════════════════════════════════════════════════════════════╝
EOF
}

install_base() {
    echo -e "${CYAN}[*] Installing base components...${NC}"
    
    # Core Wayland components
    local packages=(
        "wayland" "wayland-protocols" "wlroots"
        "xdg-desktop-portal-wlr"
        "pipewire" "pipewire-pulse" "wireplumber"
        "ttf-dejavu" "ttf-liberation" "noto-fonts"
    )
    
    if command -v pacman &>/dev/null; then
        pacman -S --noconfirm --needed "${packages[@]}" 2>/dev/null || true
    fi
    
    echo -e "${GREEN}[✓] Base components installed${NC}"
}

install_gnome() {
    echo -e "${CYAN}[*] Installing GNOME Desktop...${NC}"
    
    local packages=(
        "gnome" "gnome-tweaks" "gnome-shell-extensions"
        "gdm"
    )
    
    if command -v pacman &>/dev/null; then
        pacman -S --noconfirm --needed "${packages[@]}" 2>/dev/null || true
        systemctl enable gdm
    fi
    
    echo -e "${GREEN}[✓] GNOME installed${NC}"
}

install_kde() {
    echo -e "${CYAN}[*] Installing KDE Plasma...${NC}"
    
    local packages=(
        "plasma-meta" "kde-applications-meta"
        "sddm"
    )
    
    if command -v pacman &>/dev/null; then
        pacman -S --noconfirm --needed "${packages[@]}" 2>/dev/null || true
        systemctl enable sddm
    fi
    
    echo -e "${GREEN}[✓] KDE Plasma installed${NC}"
}

install_sway() {
    echo -e "${CYAN}[*] Installing Sway (Tiling WM)...${NC}"
    
    local packages=(
        "sway" "swaylock" "swayidle" "waybar"
        "mako" "wofi" "foot" "grim" "slurp"
    )
    
    if command -v pacman &>/dev/null; then
        pacman -S --noconfirm --needed "${packages[@]}" 2>/dev/null || true
    fi
    
    echo -e "${GREEN}[✓] Sway installed${NC}"
}

case "${1:-help}" in
    base)
        show_banner
        install_base
        ;;
    gnome)
        show_banner
        install_base
        install_gnome
        ;;
    kde)
        show_banner
        install_base
        install_kde
        ;;
    sway)
        show_banner
        install_base
        install_sway
        ;;
    *)
        show_banner
        echo -e "\nUsage: sx-desktop {base|gnome|kde|sway}"
        echo "  base  - Install base Wayland components"
        echo "  gnome - Install GNOME Desktop"
        echo "  kde   - Install KDE Plasma"
        echo "  sway  - Install Sway (Tiling WM)"
        ;;
esac
